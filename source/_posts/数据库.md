---
title: 数据库
date: 2022/3/6
categories:
  - 数据库
  
tags:
  - 数据库
  - Linux
  - 运维
  - MySQL
---



#  Mysql
##  mysql官网下载老版本
[下载网址，可选操作系统](https://dev.mysql.com/downloads/mysql/)

进入后依次选择：DOWNLOADS（下载）——>Community(社区)——MySQL Community Downloads
![在这里插入图片描述](https://img-blog.csdnimg.cn/d11d8469ebcd411faf3c9b67c4f4e02b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IiU54uXMeWPtw==,size_20,color_FFFFFF,t_70,g_se,x_16)
进入后往下拉，如下图选择Looking for previous GA versions（寻找以前的GA版本）
![在这里插入图片描述](https://img-blog.csdnimg.cn/1371dd641c0e4c3ab54e10660e5907ed.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IiU54uXMeWPtw==,size_20,color_FFFFFF,t_70,g_se,x_16)

##  centos安装mysql
本地下载mysql，但是xftp上传太慢，暂未找到解决的办法，所以尝试下面这个方法。

**1 下载并安装MySQL官方的 Yum Repository**

```
wget -i -c http://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm
```
使用上面的命令就直接下载了安装用的Yum Repository，大概25KB的样子，然后就可以直接yum安装了。

```
yum -y install mysql57-community-release-el7-10.noarch.rpm
```
 之后就开始安装MySQL服务器。

```
yum -y install mysql-community-server
```
这步可能会花些时间，安装完成后就会覆盖掉之前的mariadb。
![在这里插入图片描述](https://img-blog.csdnimg.cn/000f9e71988a495bb16d7f886050e5f7.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IiU54uXMeWPtw==,size_18,color_FFFFFF,t_70,g_se,x_16)
至此MySQL就安装完成了，然后是对MySQL的一些设置。

**2 MySQL数据库设置**

```
systemctl start  mysqld.service // 首先启动MySQL

systemctl status mysqld.service //查看MySQL运行状态
```
![在这里插入图片描述](https://img-blog.csdnimg.cn/acda61b3da8b4837ad7bdf9020468ea1.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IiU54uXMeWPtw==,size_20,color_FFFFFF,t_70,g_se,x_16)
此时MySQL已经开始正常运行，不过要想进入MySQL还得先找出此时root用户的密码，通过如下命令可以在日志文件中找出密码：

```
grep "password" /var/log/mysqld.log
```

 如下命令进入数据库：

```
 mysql -u root -p
```

输入初始密码，此时不能做任何事情，因为MySQL默认必须修改密码之后才能操作数据库：

```
mysql> ALTER USER 'root'@'localhost' IDENTIFIED BY 'new password';
//密码需要设置复杂点，不然会报错。原因是因为MySQL有密码设置的规范，具体是与validate_password_policy的值有关：
```

**3.密码修改**
***上面那一步修改是必须的，否则没法二次修改密码***

先进入mysql

查看 mysql 初始的密码策略
```
 SHOW VARIABLES LIKE 'validate_password%';
```
![在这里插入图片描述](https://img-blog.csdnimg.cn/0d3db11aae794c05adf48c94ade4094b.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IiU54uXMeWPtw==,size_20,color_FFFFFF,t_70,g_se,x_16)
首先需要设置密码的验证强度等级，设置 validate_password_policy 的全局参数为 LOW 即可

```
set global validate_password_policy=LOW; 
```

当前密码长度为 8 ，如果不介意的话就不用修改了，按照通用的来讲，设置为 6 位的密码，设置 validate_password_length 的全局参数为 6 即可

```
set global validate_password_length=6;
```

现在可以为 mysql 设置简单密码了，只要满足六位的长度即可

```
ALTER USER 'root'@'localhost' IDENTIFIED BY '123456';
```

> 注：在默认密码的长度最小值为 4 ，由 大/小写字母各一个 + 阿拉伯数字一个 + 特殊字符一个， 只要设置密码的长度小于 3
> ，都将自动设值为 4 ，如下图：
> 
> 
> <br>
> 
> 关于 mysql 密码策略相关参数；
>  1）、validate_password_length  固定密码的总长度；
> 2）、validate_password_dictionary_file 指定密码验证的文件路径；
> 3）、validate_password_mixed_case_count  整个密码中至少要包含大/小写字母的总个数；
> 4）、validate_password_number_count  整个密码中至少要包含阿拉伯数字的个数；
> 5）、validate_password_policy 指定密码的强度验证等级，默认为 MEDIUM； 关于
> validate_password_policy 的取值： 0/LOW：只验证长度； 1/MEDIUM：验证长度、数字、大小写、特殊字符；
> 2/STRONG：验证长度、数字、大小写、特殊字符、字典文件；
> 6）、validate_password_special_char_count 整个密码中至少要包含特殊字符的个数；


## 重置密码（centos7）
[原文链接](https://blog.csdn.net/cgtcsdn/article/details/101530671)
### 忘记密码
**1.设置MySQL为免密码登录**
`vi /etc/my.cnf` (部分Linux安装了vim，其命令则改为`vim /etc/my.cnf`)按【i】键进入编辑模式，在[mysqld]下面加上“skip-grant-tables”，按【Esc】键，然后输入“:wq”保存并退出vi。
![在这里插入图片描述](https://img-blog.csdnimg.cn/20190927141449601.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NndGNzZG4=,size_16,color_FFFFFF,t_70#pic_center)

**重新启动MySQL服务（使配置生效，此步骤不能省略）**

```
service mysqld restart
```

**清空旧密码**

```
mysql -u root –p （无需输入密码，直接按回车键进入）

use mysql

update user set authentication_string = '' where user = 'root';

quit
```
**删除免密码登录代码“skip-grant-tables”**

vi /etc/my.cnf，按【i】键进入编辑模式，删除[mysqld]下面的代码“skip-grant-tables”，按【Esc】键，然后输入“:wq”保存并退出vi。

**重设密码**

```
service mysqld restart

mysql -u root –p （无需输入密码，直接按回车键进入）

use mysql

ALTER USER 'root'@'%' IDENTIFIED BY 'snaiL_12';  //密码要用引号括起来
```
### 报错
***问题1***
```
ALTER USER 'root'@'localhost' IDENTIFIED BY 'snaiL_123';
```
报错：`ERROR 1819 (HY000): Your password does not satisfy the current policy requirements`

**解决：**

```
SHOW VARIABLES LIKE 'validate_password%';
```
1.2调整MySQL密码验证规则，修改 policy 和 length 的值。

```
set global validate_password——policy=0;（“0”等价于“LOW”，含义是只验证密码长度）

set global validate_password.length=8;（因为我之前动过密码长度，这里我将密码长度设为8）

```
***问题2***

```
ALTER USER 'root'@'localhost' IDENTIFIED BY 'snaiL_123';

```
报错：`ERROR 1396 (HY000): Operation ALTER USER failed for 'root'@'localhost'`

**查看root账户的host**

```
select user,host from user;
```
![在这里插入图片描述](https://img-blog.csdnimg.cn/20190927141940582.png#pic_center)

2.2注意看，我的host是“%”，你输入的命令可能是：

```
ALTERUSER 'root'@'localhost' IDENTIFIED BY 'Snail@10'; 
```
将命令改成：

```
ALTER USER 'root'@'%' IDENTIFIED BY 'Snail@10'; 
```

##  Navicat连接mysql出现1130 - Host XXX is not allowed to connect to this MySQL server
接上一条，安装完成后，navicat无法正常连接，这是由于Mysql配置了不支持远程连接引起的。

**1.在安装Mysql数据库的主机上登录root用户**

```
mysql -u root -p
```
2.依次执行如下命令：

```
use mysql;
 
select host from user where user='root';
```
可以看到当前主机配置信息为localhost.
![在这里插入图片描述](https://img-blog.csdnimg.cn/e4dee3a582374c6eba09244e9b947247.png)
3.将Host设置为通配符%

Host列指定了允许用户登录所使用的IP，比如user=root Host=192.168.1.1。这里的意思就是说root用户只能通过192.168.1.1的客户端去访问。 user=root Host=localhost，表示只能通过本机客户端去访问。而%是个通配符，如果Host=192.168.1.%，那么就表示只要是IP地址前缀为“192.168.1.”的客户端都可以连接。如果Host=%，表示所有IP都有连接权限。 



**注意：在生产环境下不能为了省事将host设置为%，这样做会存在安全问题，具体的设置可以根据生产环境的IP进行设置；**

```
update user set host = '%' where user ='root';
```

Host设置了“%”后便可以允许远程访问。

![在这里插入图片描述](https://img-blog.csdnimg.cn/8a3b8bb5074a4f8b9132a2eebdec3301.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA6IiU54uXMeWPtw==,size_14,color_FFFFFF,t_70,g_se,x_16)

4..Host修改完成后记得执行flush privileges使配置立即生效

```
flush privileges;
```


<br>
